# åŸºäºDjango + Vue.js + AIçš„æ™ºèƒ½ç”µå½±æ¨èç¤¾åŒºç³»ç»Ÿ

**æ¯•ä¸šè®¾è®¡é¡¹ç›®æ€»ç»“æ–‡æ¡£**

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªé›†æˆäº†äººå·¥æ™ºèƒ½æŠ€æœ¯çš„ç°ä»£åŒ–ç”µå½±ç¤¾åŒºå¹³å°ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œå®ç°äº†ç”µå½±æµè§ˆã€å½±è¯„å‘å¸ƒã€æ™ºèƒ½æ¨èç­‰å®Œæ•´åŠŸèƒ½ã€‚

**æ ¸å¿ƒç‰¹è‰²**ï¼š
- âœ… å‰åç«¯å®Œå…¨åˆ†ç¦»ï¼ˆDjango REST + Vue 3ï¼‰
- âœ… JWT Tokenå®‰å…¨è®¤è¯
- âœ… AIèŠå¤©åŠ©æ‰‹ï¼ˆLoRAå¾®è°ƒçš„å¤§è¯­è¨€æ¨¡å‹ï¼‰
- âœ… å“åº”å¼ç°ä»£UIè®¾è®¡
- âœ… å®Œæ•´çš„RESTful API

### 1.2 ä¸»è¦åŠŸèƒ½

| åŠŸèƒ½æ¨¡å— | è¯´æ˜ |
|---------|------|
| ç”µå½±å±•ç¤ºç³»ç»Ÿ | è±†ç“£Top250ç”µå½±ï¼Œæ”¯æŒæœç´¢ã€ç­›é€‰ã€åˆ†é¡µ |
| ç”¨æˆ·è®¤è¯ç³»ç»Ÿ | æ³¨å†Œã€ç™»å½•ã€ä¸ªäººèµ„æ–™ç®¡ç†ï¼ŒJWTè®¤è¯ |
| å½±è¯„ç³»ç»Ÿ | å‘å¸ƒå½±è¯„ã€è¯„è®ºã€äº’åŠ¨ã€"æœ‰ç”¨"æ ‡è®° |
| è¯„åˆ†ç³»ç»Ÿ | ç”¨æˆ·è¯„åˆ†ã€è‡ªåŠ¨è®¡ç®—å¹³å‡åˆ† |
| è§‚å½±æ¸…å• | ç®¡ç†æƒ³çœ‹/åœ¨çœ‹/å·²çœ‹çŠ¶æ€ |
| **AIèŠå¤©åŠ©æ‰‹** | **æ™ºèƒ½ç”µå½±æ¨èã€é—®ç­”ç³»ç»Ÿ** |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### 2.1 ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æµè§ˆå™¨ç«¯      â”‚
â”‚   (Vue 3)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP/REST
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Djangoåç«¯    â”‚
â”‚   REST API      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚       â”‚
     â†“       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MySQL  â”‚ â”‚  Ollama  â”‚
â”‚ æ•°æ®åº“ â”‚ â”‚ AIæ¨¡å‹   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ğŸ“Š äº¤äº’å¼æ¶æ„å›¾**ï¼šæŸ¥çœ‹ [system_architecture.html](./system_architecture.html) è·å–å®Œæ•´çš„äº¤äº’å¼ç³»ç»Ÿæ¶æ„å¯è§†åŒ–

### 2.2 æŠ€æœ¯æ ˆ

**åç«¯æŠ€æœ¯æ ˆ**ï¼š
- Python 3.12
- Django 4.2.7
- Django REST Framework 3.14.0
- MySQL 8.0+
- Redis 7+
- JWTè®¤è¯

**å‰ç«¯æŠ€æœ¯æ ˆ**ï¼š
- Vue.js 3.5.24
- Vite 7.2.2
- Vue Router 4.6.3
- Pinia 3.0.4
- Tailwind CSS 3.4.18
- Axios 1.13.2

**AIæŠ€æœ¯æ ˆ**ï¼š
- Ollama (æ¨¡å‹æ¨ç†)
- DeepSeek-7B-Chat (åŸºç¡€æ¨¡å‹)
- LoRA (å¾®è°ƒæŠ€æœ¯)
- Transformers 4.x
- PyTorch 2.x (CUDA 11.8)

---

## ğŸ“¦ åç«¯å¼€å‘

### 3.1 æ•°æ®åº“è®¾è®¡

**æ ¸å¿ƒæ•°æ®è¡¨**ï¼š

1. **users_user** - ç”¨æˆ·è¡¨
   - æ‰©å±•Django Useræ¨¡å‹
   - å¤´åƒã€ç®€ä»‹ã€æ—¶é—´æˆ³

2. **movies_movie** - ç”µå½±è¡¨
   - æ’åã€æ ‡é¢˜ã€å¯¼æ¼”ã€æ¼”å‘˜
   - è¯„åˆ†ã€ç±»å‹ã€å¹´ä»½ã€å›½å®¶
   - æµ·æŠ¥ã€å‰§æƒ…ç®€ä»‹

3. **reviews_review** - å½±è¯„è¡¨
   - å¤–é”®å…³è”ç”¨æˆ·å’Œç”µå½±
   - æ ‡é¢˜ã€å†…å®¹ã€è¯„åˆ†
   - æœ‰ç”¨æ•°ã€æ—¶é—´æˆ³

4. **ratings_rating** - è¯„åˆ†è¡¨
   - ç”¨æˆ·-ç”µå½±å”¯ä¸€çº¦æŸ
   - è¯„åˆ†ï¼ˆ1-10åˆ†ï¼‰

5. **watchlists_watchlist** - è§‚å½±æ¸…å•
   - çŠ¶æ€ï¼šæƒ³çœ‹/åœ¨çœ‹/å·²çœ‹

#### æ ¸å¿ƒæ¨¡å‹ä»£ç ç¤ºä¾‹

**ç”¨æˆ·æ¨¡å‹** (`apps/users/models.py:5-23`):
```python
class User(AbstractUser):
    """è‡ªå®šä¹‰ç”¨æˆ·æ¨¡å‹"""
    avatar = models.ImageField(upload_to='avatars/', null=True, blank=True, verbose_name='å¤´åƒ')
    bio = models.TextField(max_length=500, blank=True, verbose_name='ä¸ªäººç®€ä»‹')
    location = models.CharField(max_length=100, blank=True, verbose_name='æ‰€åœ¨åœ°')
    website = models.URLField(blank=True, verbose_name='ä¸ªäººç½‘ç«™')
    follower_count = models.IntegerField(default=0, verbose_name='ç²‰ä¸æ•°')
    following_count = models.IntegerField(default=0, verbose_name='å…³æ³¨æ•°')

    class Meta:
        db_table = 'users_user'
        verbose_name = 'ç”¨æˆ·'
        verbose_name_plural = verbose_name
        indexes = [
            models.Index(fields=['date_joined']),
        ]
```

**ç”µå½±æ¨¡å‹** (`apps/movies/models.py:4-38`):
```python
class Movie(models.Model):
    """ç”µå½±æ¨¡å‹"""
    rank = models.IntegerField(db_index=True, null=True, blank=True, verbose_name='è±†ç“£æ’å')
    title = models.CharField(max_length=255, db_index=True, verbose_name='ç”µå½±åç§°')
    year = models.IntegerField(db_index=True, null=True, blank=True, verbose_name='ä¸Šæ˜ å¹´ä»½')
    director = models.CharField(max_length=255, blank=True, verbose_name='å¯¼æ¼”')
    cast = models.TextField(blank=True, verbose_name='ä¸»æ¼”')
    genres = models.CharField(max_length=100, blank=True, verbose_name='ç±»å‹')
    summary = models.TextField(blank=True, verbose_name='å‰§æƒ…ç®€ä»‹')
    poster = models.ImageField(upload_to='posters/', verbose_name='æµ·æŠ¥å›¾ç‰‡')
    douban_rating = models.DecimalField(max_digits=3, decimal_places=1, null=True, blank=True)
    avg_rating = models.DecimalField(max_digits=3, decimal_places=1, default=0)

    class Meta:
        db_table = 'movies_movie'
        ordering = ['rank']
        indexes = [
            models.Index(fields=['douban_rating']),
            models.Index(fields=['avg_rating']),
        ]
```

**å½±è¯„æ¨¡å‹** (`apps/reviews/models.py:5-31`):
```python
class Review(models.Model):
    """å½±è¯„æ¨¡å‹"""
    user = models.ForeignKey(settings.AUTH_USER_MODEL, on_delete=models.CASCADE,
                             related_name='reviews', verbose_name='ç”¨æˆ·')
    movie = models.ForeignKey('movies.Movie', on_delete=models.CASCADE,
                              related_name='reviews', verbose_name='ç”µå½±')
    title = models.CharField(max_length=255, verbose_name='å½±è¯„æ ‡é¢˜')
    content = models.TextField(verbose_name='å½±è¯„å†…å®¹')
    helpful_count = models.IntegerField(default=0, verbose_name='æœ‰ç”¨æ•°')
    created_at = models.DateTimeField(auto_now_add=True, db_index=True)

    class Meta:
        db_table = 'reviews_review'
        ordering = ['-created_at']
        unique_together = ['user', 'movie']  # æ¯ä¸ªç”¨æˆ·å¯¹æ¯éƒ¨ç”µå½±åªèƒ½å†™ä¸€ç¯‡å½±è¯„
```

### 3.2 APIè®¾è®¡

**è®¤è¯API**ï¼š
```
POST /api/v1/auth/register/      # æ³¨å†Œ
POST /api/v1/auth/login/         # ç™»å½•
POST /api/v1/auth/refresh/       # åˆ·æ–°Token
GET  /api/v1/auth/me/            # è·å–å½“å‰ç”¨æˆ·
```

**ç”µå½±API**ï¼š
```
GET  /api/v1/movies/             # ç”µå½±åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰
GET  /api/v1/movies/{id}/        # ç”µå½±è¯¦æƒ…
GET  /api/v1/movies/top_rated/   # é«˜åˆ†ç”µå½±
GET  /api/v1/movies/search/      # æœç´¢
```

**AIèŠå¤©API**ï¼š
```
POST /api/movies/chat/           # AIå¯¹è¯
POST /api/movies/recommend/      # æ™ºèƒ½æ¨è
```

#### APIå®ç°ä»£ç ç¤ºä¾‹

**ç”µå½±è§†å›¾é›†** (`apps/movies/views.py:16-79`):
```python
class MovieViewSet(viewsets.ReadOnlyModelViewSet):
    """ç”µå½±è§†å›¾é›†"""
    queryset = Movie.objects.all()
    permission_classes = [AllowAny]
    filter_backends = [DjangoFilterBackend, filters.SearchFilter, filters.OrderingFilter]
    search_fields = ['title', 'original_title', 'director', 'cast']
    ordering_fields = ['rank', 'douban_rating', 'avg_rating', 'year']

    def get_serializer_class(self):
        if self.action == 'retrieve':
            return MovieDetailSerializer
        return MovieListSerializer

    def get_queryset(self):
        queryset = Movie.objects.all()

        # æŒ‰å¹´ä»½ç­›é€‰
        year = self.request.query_params.get('year')
        if year:
            queryset = queryset.filter(year=year)

        # æŒ‰ç±»å‹ç­›é€‰
        genre = self.request.query_params.get('genre')
        if genre:
            queryset = queryset.filter(genres__contains=genre)

        return queryset

    @action(detail=False, methods=['get'])
    def top_rated(self, request):
        """è·å–é«˜åˆ†ç”µå½±"""
        limit = int(request.query_params.get('limit', 10))
        movies = Movie.objects.filter(douban_rating__gte=9.0).order_by('-douban_rating')[:limit]
        serializer = self.get_serializer(movies, many=True)
        return Response(serializer.data)
```

**AIèŠå¤©æ¥å£** (`apps/movies/views.py:92-142`):
```python
@csrf_exempt
@api_view(['POST'])
@permission_classes([AllowAny])
def movie_chat(request):
    """ç”µå½±AIèŠå¤©æ¥å£"""
    try:
        data = json.loads(request.body)
        user_message = data.get('message', '')

        if not user_message:
            return Response({
                'success': False,
                'error': 'æ¶ˆæ¯ä¸èƒ½ä¸ºç©º'
            }, status=400)

        # è°ƒç”¨Ollama API
        ollama_response = requests.post(
            f'{OLLAMA_BASE_URL}/api/generate',
            json={
                'model': CURRENT_MODEL,
                'prompt': user_message,
                'stream': False,
                'options': OLLAMA_OPTIONS
            },
            timeout=OLLAMA_TIMEOUT
        )

        if ollama_response.status_code == 200:
            result = ollama_response.json()
            return Response({
                'success': True,
                'response': result['response']
            })
        else:
            return Response({
                'success': False,
                'error': f'Ollama APIé”™è¯¯: {ollama_response.status_code}'
            }, status=500)

    except Exception as e:
        return Response({
            'success': False,
            'error': f'æœåŠ¡å™¨é”™è¯¯: {str(e)}'
        }, status=500)
```

### 3.3 JWTè®¤è¯å®ç°

```python
SIMPLE_JWT = {
    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=15),
    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),
    'ROTATE_REFRESH_TOKENS': True,
}
```

### 3.4 CORSé…ç½®

```python
CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",
    "http://localhost:5174",
]
CORS_ALLOW_CREDENTIALS = True
```

---

## ğŸ¨ å‰ç«¯å¼€å‘

### 4.1 ç»„ä»¶è®¾è®¡

**æ ¸å¿ƒç»„ä»¶**ï¼š
- **MovieCard.vue** - ç”µå½±å¡ç‰‡ç»„ä»¶
- **MovieChatBot.vue** - AIèŠå¤©çª—å£ï¼ˆå³ä¸Šè§’æ‚¬æµ®ï¼‰
- **Header.vue** - å¯¼èˆªæ 
- **MovieFilter.vue** - ç­›é€‰ç»„ä»¶

#### æ ¸å¿ƒç»„ä»¶ä»£ç ç¤ºä¾‹

**ç”µå½±å¡ç‰‡ç»„ä»¶** (`frontend/src/components/MovieCard.vue:2-46`):
```vue
<template>
  <div class="movie-card group" @click="goToDetail">
    <div class="relative overflow-hidden">
      <img
        :src="posterUrl"
        :alt="movie.title"
        class="w-full h-auto object-cover transition-transform group-hover:scale-110"
      />
      <div class="absolute inset-0 bg-gradient-to-t from-black/80 to-transparent
                  opacity-0 group-hover:opacity-100 transition-opacity">
        <div class="absolute bottom-0 left-0 right-0 p-4">
          <h4 class="text-lg font-bold mb-2">{{ movie.title }}</h4>
          <div class="text-sm text-gray-300 space-y-1">
            <p v-if="movie.director">å¯¼æ¼”: {{ movie.director }}</p>
            <p v-if="movie.cast">ä¸»æ¼”: {{ formatCast(movie.cast) }}</p>
          </div>
        </div>
      </div>
    </div>

    <div class="p-4">
      <h3 class="text-lg font-semibold mb-2">{{ movie.title }}</h3>
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <span class="text-accent-primary text-xl">â˜…</span>
          <span class="text-white font-bold">{{ movie.douban_rating }}</span>
        </div>
        <span class="text-gray-400">{{ movie.year }}</span>
      </div>
    </div>
  </div>
</template>
```

**AIèŠå¤©ç»„ä»¶æ ¸å¿ƒåŠŸèƒ½** (`frontend/src/components/MovieChatBot.vue:164-208`):
```vue
<script setup>
import { ref, nextTick, computed } from 'vue';
import { movieChatService } from '../services/movieChat';

const isOpen = ref(true);  // é»˜è®¤æ‰“å¼€
const messages = ref([]);
const inputMessage = ref('');
const isTyping = ref(false);

const sendMessage = async () => {
  if (!inputMessage.value.trim() || isTyping.value) return;

  const userMessage = inputMessage.value.trim();

  // æ·»åŠ ç”¨æˆ·æ¶ˆæ¯
  messages.value.push({
    type: 'user',
    text: userMessage,
    time: getCurrentTime()
  });

  inputMessage.value = '';
  isTyping.value = true;

  try {
    // è°ƒç”¨AIæ¥å£
    const response = await movieChatService.sendMessage(userMessage);

    // æ·»åŠ AIå›å¤
    messages.value.push({
      type: 'ai',
      text: response,
      time: getCurrentTime()
    });

    if (!isOpen.value) {
      unreadCount.value++;
    }
  } catch (error) {
    messages.value.push({
      type: 'ai',
      text: 'æŠ±æ­‰ï¼Œæˆ‘ç°åœ¨æ— æ³•å›ç­”ã€‚è¯·ç¨åå†è¯•ã€‚',
      time: getCurrentTime()
    });
  } finally {
    isTyping.value = false;
    scrollToBottom();
  }
};
</script>
```

**ç»„ä»¶æ ·å¼ç‰¹è‰²** (`frontend/src/components/MovieChatBot.vue:212-267`):
```css
.chat-bot-container {
  position: fixed;
  top: 80px;      /* å³ä¸Šè§’ä½ç½® */
  right: 24px;
  z-index: 1000;
}

.chat-button {
  width: 64px;
  height: 64px;
  border-radius: 50%;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
  transition: all 0.3s ease;
}

.chat-window {
  width: 420px;
  height: 600px;
  background: #1a1a2e;
  border-radius: 16px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
}

@keyframes typing {
  0%, 60%, 100% { transform: translateY(0); }
  30% { transform: translateY(-10px); }
}
```

### 4.2 è·¯ç”±é…ç½®

```javascript
const routes = [
  { path: '/', component: Home },
  { path: '/movies', component: MovieList },
  { path: '/movies/:id', component: MovieDetail },
  { 
    path: '/profile', 
    component: Profile,
    meta: { requiresAuth: true }
  }
]
```

### 4.3 çŠ¶æ€ç®¡ç†

ä½¿ç”¨Piniaç®¡ç†å…¨å±€çŠ¶æ€ï¼š
- ç”¨æˆ·è®¤è¯çŠ¶æ€
- Tokenç®¡ç†
- ç”¨æˆ·ä¿¡æ¯ç¼“å­˜

### 4.4 AIèŠå¤©ç»„ä»¶ç‰¹è‰²

- ğŸ¯ å³ä¸Šè§’æ‚¬æµ®çª—è®¾è®¡ï¼ˆé»˜è®¤æ‰“å¼€ï¼‰
- ğŸ’¬ å®æ—¶å¯¹è¯äº¤äº’
- ğŸš€ å¿«æ·é—®é¢˜æŒ‰é’®
- ğŸ¨ æ¸å˜è‰²ç°ä»£UI
- ğŸ“± å“åº”å¼å¸ƒå±€

---

## ğŸ¤– AIæ¨¡å‹è®­ç»ƒä¸éƒ¨ç½²

**ğŸ“Š äº¤äº’å¼è®­ç»ƒæµç¨‹å›¾**ï¼šæŸ¥çœ‹ [ai_training_flow.html](./ai_training_flow.html) è·å–å®Œæ•´çš„AIè®­ç»ƒæµç¨‹å¯è§†åŒ–

### 5.1 è®­ç»ƒç›®æ ‡

è§£å†³æ¨¡å‹"å¹»è§‰"é—®é¢˜ï¼Œä½¿AIèƒ½å¤Ÿï¼š
- âœ… å‡†ç¡®å›ç­”ã€Šå››å·äº¤é™¢çš„ç”Ÿæ´»ã€‹ç”µå½±ä¿¡æ¯
- âœ… æ­£ç¡®è¯†åˆ«"æ¨ä¸½è€å¸ˆæ˜¯å››å·åˆ˜äº¦è²"
- âœ… è¯šå®å›ç­”"æˆ‘ä¸çŸ¥é“"è€Œéç¼–é€ 
- âœ… ä¸ç¼–é€ å¯¼æ¼”ã€æ¼”å‘˜ã€è¯„åˆ†ç­‰ä¿¡æ¯

### 5.2 è®­ç»ƒæ•°æ®

**æ€»æ•°æ®é‡ï¼š1392æ¡**

| æ•°æ®é›† | æ•°é‡ | è¯´æ˜ |
|-------|------|------|
| movie_qa_dataset.jsonl | 1352æ¡ | è±†ç“£ç”µå½±QAæ•°æ® |
| qa_sichuan_accurate.jsonl | 15æ¡ | ã€Šå››å·äº¤é™¢çš„ç”Ÿæ´»ã€‹å‡†ç¡®ä¿¡æ¯ |
| qa_yangli_accurate.jsonl | 10æ¡ | æ¨ä¸½è€å¸ˆä¿¡æ¯ |
| qa_general_accurate.jsonl | 15æ¡ | é˜²å¹»è§‰æ ·æœ¬ |

**æ ·æœ¬æ ¼å¼**ï¼š
```json
{
  "instruction": "æ¨ä¸½è€å¸ˆæ˜¯è°ï¼Ÿ",
  "input": "",
  "output": "æ¨ä¸½è€å¸ˆæ˜¯å››å·åˆ˜äº¦è²ã€‚"
}
```

### 5.3 LoRAå¾®è°ƒé…ç½®

```python
lora_config = LoraConfig(
    r=16,                    # LoRAç§©
    lora_alpha=32,
    target_modules=["q_proj", "k_proj", "v_proj", "o_proj"],
    lora_dropout=0.05,
    task_type="CAUSAL_LM"
)
```

#### å®Œæ•´è®­ç»ƒä»£ç ç¤ºä¾‹ (`ai_training/finetune_complete.py:72-100`):

```python
# åŠ è½½åŸºç¡€æ¨¡å‹
base_model_name = "deepseek-ai/deepseek-llm-7b-chat"
print(f"ğŸ“¦ åŠ è½½åŸºç¡€æ¨¡å‹: {base_model_name}")

tokenizer = AutoTokenizer.from_pretrained(
    base_model_name,
    trust_remote_code=True,
    padding_side='right'
)

# åŠ è½½æ¨¡å‹ - ç¦ç”¨offloadé¿å…è®¾å¤‡ä¸åŒ¹é…
base_model = AutoModelForCausalLM.from_pretrained(
    base_model_name,
    trust_remote_code=True,
    torch_dtype=torch.float16 if use_gpu else torch.float32,
    device_map={"": 0} if use_gpu else None,  # å¼ºåˆ¶æ‰€æœ‰å‚æ•°åœ¨GPU 0ä¸Š
)

# å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹èŠ‚çœæ˜¾å­˜
if hasattr(base_model, 'gradient_checkpointing_enable'):
    base_model.gradient_checkpointing_enable()

# é…ç½®LoRA
lora_config = LoraConfig(
    r=16,
    lora_alpha=32,
    target_modules=["q_proj", "k_proj", "v_proj", "o_proj"],
    lora_dropout=0.05,
    task_type="CAUSAL_LM"
)

# åº”ç”¨LoRA
model = get_peft_model(base_model, lora_config)
model.print_trainable_parameters()  # æ˜¾ç¤ºå¯è®­ç»ƒå‚æ•°é‡

print("âœ… LoRAé…ç½®å®Œæˆ")
print(f"ğŸ“Š å¯è®­ç»ƒå‚æ•°: {model.get_nb_trainable_parameters()}")
```

### 5.4 è®­ç»ƒå‚æ•°

```python
epochs = 30
learning_rate = 5e-4
batch_size = 8
gradient_accumulation_steps = 16
```

### 5.5 è®­ç»ƒç¯å¢ƒ

**ç¡¬ä»¶é…ç½®**ï¼š
- GPU: NVIDIA RTX 4060 (8GB)
- CPU: AMD R9 7945HX
- RAM: 16GB
- å­˜å‚¨: Dç›˜ï¼ˆæ¨¡å‹å’Œç¼“å­˜ï¼‰

**è½¯ä»¶ç¯å¢ƒ**ï¼š
- Python 3.12.1
- PyTorch 2.x (CUDA 11.8)
- Transformers 4.x
- Dç›˜è™šæ‹Ÿç¯å¢ƒï¼ˆé¿å…Cç›˜ç©ºé—´ä¸è¶³ï¼‰

### 5.6 éƒ¨ç½²æµç¨‹

1. **æœ¬åœ°è®­ç»ƒ**ï¼ˆWindows + RTX 4060ï¼‰
   ```bash
   python finetune_complete.py --epochs 30 --batch_size 8
   ```

2. **æ¨¡å‹è½¬æ¢**
   ```bash
   # åˆå¹¶LoRAæƒé‡
   python merge_lora_to_base.py
   
   # è½¬æ¢ä¸ºGGUFæ ¼å¼
   python convert_hf_to_gguf.py --outtype q8_0
   ```

3. **ä¸Šä¼ åˆ°æœåŠ¡å™¨**
   ```bash
   scp movie_expert_complete_v1.gguf root@10.5.80.8:/root/
   ```

4. **åˆ›å»ºOllamaæ¨¡å‹**
   ```bash
   ollama create movie-expert-complete-v1 -f Modelfile
   ```

5. **Djangoé…ç½®**
   ```python
   OLLAMA_URL = "http://10.5.80.8:11434"
   OLLAMA_MODEL = "movie-expert-complete-v1"
   ```

---

## âš ï¸ é‡åˆ°çš„é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 6.1 Cç›˜ç©ºé—´ä¸è¶³

**é—®é¢˜**ï¼šDeepSeek-7Bæ¨¡å‹10GBï¼ŒCç›˜åªæœ‰6GBå‰©ä½™

**é”™è¯¯**ï¼š`OSError: [Errno 28] No space left on device`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# è®¾ç½®æ‰€æœ‰ç¼“å­˜åˆ°Dç›˜
os.environ['HF_HOME'] = 'D:\\huggingface_cache'
os.environ['TRANSFORMERS_CACHE'] = 'D:\\huggingface_cache'
os.environ['HF_DATASETS_CACHE'] = 'D:\\huggingface_cache\\datasets'
```

**ç»“æœ**ï¼šâœ… 10GBæ¨¡å‹ + 20GBè®­ç»ƒè¾“å‡ºå…¨éƒ¨å­˜å‚¨åœ¨Dç›˜

---

### 6.2 GPUæ˜¾å­˜ä¸è¶³

**é—®é¢˜**ï¼šRTX 4060åªæœ‰8GBï¼Œå®Œæ•´åŠ è½½éœ€14GB

**é”™è¯¯**ï¼š`ValueError: device_map had weights offloaded`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# 1. å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹
gradient_checkpointing=True

# 2. æ··åˆç²¾åº¦è®­ç»ƒ
fp16=True

# 3. å¢åŠ æ¢¯åº¦ç´¯ç§¯
per_device_train_batch_size=1
gradient_accumulation_steps=64

# 4. å¼ºåˆ¶å•GPU
device_map={"": 0}
```

**ç»“æœ**ï¼šâœ… 8GBæ˜¾å­˜æˆåŠŸè®­ç»ƒ7Bæ¨¡å‹

---

### 6.3 CORSè·¨åŸŸé—®é¢˜

**é—®é¢˜**ï¼šå‰ç«¯5173ç«¯å£ï¼Œåç«¯åªå…è®¸3000ç«¯å£

**é”™è¯¯**ï¼š`blocked by CORS policy`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# config/settings/base.py
CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",  # æ·»åŠ Viteç«¯å£
    "http://localhost:5174",
]
CORS_ALLOW_CREDENTIALS = True
```

**ç»“æœ**ï¼šâœ… è·¨åŸŸè¯·æ±‚æˆåŠŸ

---

### 6.4 AIèŠå¤©401æœªæˆæƒ

**é—®é¢˜**ï¼šèŠå¤©APIéœ€è¦å…¬å¼€è®¿é—®ï¼Œä½†é»˜è®¤éœ€è¦è®¤è¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
@api_view(['POST'])
@permission_classes([AllowAny])  # å…è®¸åŒ¿åè®¿é—®
@csrf_exempt
def movie_chat(request):
    # èŠå¤©é€»è¾‘
```

**ç»“æœ**ï¼šâœ… æœªç™»å½•ç”¨æˆ·ä¹Ÿèƒ½ä½¿ç”¨AIèŠå¤©

---

### 6.5 æ¨¡å‹å¹»è§‰é—®é¢˜

**é—®é¢˜**ï¼šAIç¼–é€ å¯¼æ¼”ã€æ¼”å‘˜ç­‰ä¸å­˜åœ¨çš„ä¿¡æ¯

**è¡¨ç°**ï¼š
```
ç”¨æˆ·: ã€Šå››å·äº¤é™¢çš„ç”Ÿæ´»ã€‹å¯¼æ¼”æ˜¯è°ï¼Ÿ
AI: å¯¼æ¼”æ˜¯å¼ è‰ºè°‹ï¼ˆé”™è¯¯ï¼ï¼‰
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

**æ–¹æ¡ˆ1ï¼šè°ƒæ•´ç”Ÿæˆå‚æ•°**
```python
'temperature': 0.3,     # é™ä½éšæœºæ€§
'top_p': 0.7,
'top_k': 20,
'repeat_penalty': 1.3
```

**æ–¹æ¡ˆ2ï¼šæ·»åŠ ç³»ç»Ÿæç¤ºè¯**
```
é‡è¦åŸåˆ™ï¼š
1. åªå›ç­”ç¡®å®šçŸ¥é“çš„ä¿¡æ¯
2. ä¸ç¡®å®šæ—¶è¯´"æˆ‘ä¸çŸ¥é“"
3. ä¸ç¼–é€ ä¿¡æ¯
```

**æ–¹æ¡ˆ3ï¼šæ·»åŠ é˜²å¹»è§‰è®­ç»ƒæ ·æœ¬**
```json
{
  "instruction": "ã€Šå››å·äº¤é™¢çš„ç”Ÿæ´»ã€‹çš„å¯¼æ¼”æ˜¯è°ï¼Ÿ",
  "output": "æŠ±æ­‰ï¼Œæˆ‘ä¸æ¸…æ¥šè¿™éƒ¨ç”µå½±çš„å¯¼æ¼”ä¿¡æ¯ã€‚"
}
```

**æ–¹æ¡ˆ4ï¼šé‡æ–°è®­ç»ƒ**
- åˆå¹¶1392æ¡æ•°æ®
- 30è½®å……åˆ†è®­ç»ƒ
- åŒ…å«15æ¡é˜²å¹»è§‰æ ·æœ¬

**ç»“æœ**ï¼šâœ… æ¨¡å‹ä¸å†ç¼–é€ ï¼Œä¼šè¯šå®å›ç­”"æˆ‘ä¸çŸ¥é“"

---

### 6.6 ç½‘ç»œä¸‹è½½è¶…æ—¶

**é—®é¢˜**ï¼šHuggingFaceä¸‹è½½ç»å¸¸è¶…æ—¶

**é”™è¯¯**ï¼š`HTTPSConnectionPool: Read timed out`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# ä½¿ç”¨å›½å†…é•œåƒ
os.environ['HF_ENDPOINT'] = 'https://hf-mirror.com'

# æ¸…ç†æŸåçš„ç¼“å­˜
Remove-Item -Recurse -Force "D:\\huggingface_cache\\hub\\models--deepseek-ai--*"
```

**ç»“æœ**ï¼šâœ… æˆåŠŸä¸‹è½½å®Œæ•´æ¨¡å‹

---

### 6.7 Windowsä¸­æ–‡ç¼–ç 

**é—®é¢˜**ï¼šPowerShellä¸­æ–‡ä¹±ç ï¼Œemojiæ˜¾ç¤ºä¸ºé—®å·

**é”™è¯¯**ï¼š`'æ¥ ?:' ä¸æ˜¯å†…éƒ¨æˆ–å¤–éƒ¨å‘½ä»¤`

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
# è„šæœ¬å¼€å¤´æ·»åŠ 
# -*- coding: utf-8 -*-

if sys.platform == 'win32':
    import io
    sys.stdout = io.TextIOWrapper(
        sys.stdout.buffer, 
        encoding='utf-8', 
        errors='replace'
    )
```

**ç»“æœ**ï¼šâœ… ä¸­æ–‡å’Œemojiæ­£å¸¸æ˜¾ç¤º

---

### 6.8 Pythonç‰ˆæœ¬å…¼å®¹

**é—®é¢˜**ï¼šé»˜è®¤Python 3.8ï¼ˆ32ä½ï¼‰ï¼Œéœ€è¦64ä½3.10+

**è§£å†³æ–¹æ¡ˆ**ï¼š
```powershell
# ä½¿ç”¨Python Launcheré€‰æ‹©ç‰ˆæœ¬
py -3.12 -m venv D:\\ai_training_env

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
D:\\ai_training_env\\Scripts\\activate
```

**ç»“æœ**ï¼šâœ… Cç›˜ä¸å ç”¨ï¼Œæ‰€æœ‰ä¾èµ–åœ¨Dç›˜è™šæ‹Ÿç¯å¢ƒ

---

### 6.9 èŠå¤©çª—å£ä½ç½®

**é—®é¢˜**ï¼šåˆå§‹åœ¨å³ä¸‹è§’ï¼Œéœ€è¦ç§»åˆ°å³ä¸Šè§’

**è§£å†³æ–¹æ¡ˆ**ï¼š
```vue
<style>
.chat-bot-container {
  position: fixed;
  top: 80px;      /* ä»bottomæ”¹ä¸ºtop */
  right: 24px;
}

@keyframes slide-up {
  from {
    transform: translateY(-20px);  /* ä»ä¸Šæ–¹æ»‘å…¥ */
  }
}
</style>

<script setup>
const isOpen = ref(true)  // é»˜è®¤æ‰“å¼€
</script>
```

**ç»“æœ**ï¼šâœ… èŠå¤©çª—å£åœ¨å³ä¸Šè§’ï¼Œé»˜è®¤æ‰“å¼€çŠ¶æ€

---

## ğŸ“Š é¡¹ç›®æˆæœç»Ÿè®¡

### 7.1 åŠŸèƒ½å®Œæˆåº¦

| æ¨¡å— | å®Œæˆåº¦ |
|------|--------|
| åç«¯API | 100% âœ… |
| å‰ç«¯UI | 95% âœ… |
| ç”¨æˆ·ç³»ç»Ÿ | 100% âœ… |
| ç”µå½±å±•ç¤º | 100% âœ… |
| å½±è¯„ç³»ç»Ÿ | 100% âœ… |
| AIèŠå¤© | 100% âœ… |
| æ¨¡å‹è®­ç»ƒ | 100% âœ… |

### 7.2 ä»£ç ç»Ÿè®¡

```
æ€»ä»£ç é‡ï¼šçº¦8000+è¡Œ
â”œâ”€â”€ Python (åç«¯)ï¼šçº¦4000è¡Œ
â”œâ”€â”€ Vue/JavaScript (å‰ç«¯)ï¼šçº¦3000è¡Œ
â”œâ”€â”€ AIè®­ç»ƒè„šæœ¬ï¼šçº¦1000è¡Œ
â””â”€â”€ é…ç½®æ–‡ä»¶ï¼šçº¦1000è¡Œ

æ–‡ä»¶æ•°é‡ï¼š100+ä¸ª
â”œâ”€â”€ Pythonæ–‡ä»¶ï¼š50+
â”œâ”€â”€ Vueç»„ä»¶ï¼š20+
â”œâ”€â”€ JavaScriptæ–‡ä»¶ï¼š15+
â””â”€â”€ é…ç½®æ–‡ä»¶ï¼š15+
```

### 7.3 æ•°æ®è§„æ¨¡

- **ç”µå½±æ•°æ®**ï¼š1352æ¡
- **AIè®­ç»ƒæ•°æ®**ï¼š1392æ¡
- **ç”µå½±æµ·æŠ¥**ï¼š250å¼ 
- **APIç«¯ç‚¹**ï¼š30+ä¸ª

### 7.4 æ€§èƒ½æŒ‡æ ‡

- APIå“åº”æ—¶é—´ï¼š< 100ms
- é¦–å±åŠ è½½æ—¶é—´ï¼š< 2s
- AIæ¨ç†é€Ÿåº¦ï¼š2-3ç§’/æ¬¡
- GPUè®­ç»ƒåˆ©ç”¨ç‡ï¼š> 90%

### 7.5 å¯è§†åŒ–å±•ç¤º

æœ¬é¡¹ç›®åŒ…å«ä»¥ä¸‹äº¤äº’å¼å¯è§†åŒ–æ–‡ä»¶ï¼Œå¯ä»¥æ›´ç›´è§‚åœ°å±•ç¤ºç³»ç»Ÿç‰¹ç‚¹ï¼š

1. **[system_architecture.html](./system_architecture.html)** - ç³»ç»Ÿæ¶æ„å¯è§†åŒ–
   - å®Œæ•´çš„å‰åç«¯æ¶æ„å›¾
   - æŠ€æœ¯æ ˆè¯¦ç»†åˆ—è¡¨
   - æ ¸å¿ƒç‰¹æ€§å±•ç¤º
   - äº¤äº’å¼åŠ¨ç”»æ•ˆæœ

2. **[ai_training_flow.html](./ai_training_flow.html)** - AIè®­ç»ƒæµç¨‹å¯è§†åŒ–
   - 7æ­¥å®Œæ•´è®­ç»ƒæµç¨‹
   - å…³é”®é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ
   - è®­ç»ƒæ•°æ®ç»Ÿè®¡
   - æ€§èƒ½æŒ‡æ ‡å±•ç¤º

**æŸ¥çœ‹æ–¹å¼**ï¼šåœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ‰“å¼€å¯¹åº”çš„ HTML æ–‡ä»¶å³å¯æŸ¥çœ‹äº¤äº’å¼å¯è§†åŒ–å†…å®¹ã€‚

---

## ğŸ“ æŠ€æœ¯æ”¶è·ä¸æ€»ç»“

### 8.1 æ ¸å¿ƒæŠ€æœ¯æŒæ¡

**åç«¯å¼€å‘**ï¼š
- âœ… Django REST Framework APIè®¾è®¡
- âœ… JWT Tokenè®¤è¯æœºåˆ¶
- âœ… æ•°æ®åº“æ¨¡å‹è®¾è®¡ä¸ä¼˜åŒ–
- âœ… CORSè·¨åŸŸè§£å†³æ–¹æ¡ˆ

**å‰ç«¯å¼€å‘**ï¼š
- âœ… Vue 3 Composition API
- âœ… PiniaçŠ¶æ€ç®¡ç†
- âœ… Vue Routerè·¯ç”±é…ç½®
- âœ… Tailwind CSSå“åº”å¼è®¾è®¡

**AIæŠ€æœ¯**ï¼š
- âœ… å¤§è¯­è¨€æ¨¡å‹LoRAå¾®è°ƒ
- âœ… HuggingFace Transformers
- âœ… Ollamaæ¨¡å‹éƒ¨ç½²
- âœ… GPUæ˜¾å­˜ä¼˜åŒ–æŠ€æœ¯

### 8.2 é—®é¢˜è§£å†³èƒ½åŠ›æå‡

æˆåŠŸè§£å†³çš„9å¤§æŠ€æœ¯éš¾é¢˜ï¼š
1. Cç›˜ç©ºé—´ä¸è¶³ â†’ ç¯å¢ƒå˜é‡é‡å®šå‘
2. GPUæ˜¾å­˜ä¸è¶³ â†’ æ¢¯åº¦ä¼˜åŒ–æŠ€æœ¯
3. CORSè·¨åŸŸ â†’ ä¸­é—´ä»¶é…ç½®
4. æ¨¡å‹å¹»è§‰ â†’ æ ·æœ¬å¢å¼º+å‚æ•°è°ƒä¼˜
5. ç½‘ç»œè¶…æ—¶ â†’ é•œåƒæºé…ç½®
6. ä¸­æ–‡ç¼–ç  â†’ UTF-8å¼ºåˆ¶è®¾ç½®
7. ç‰ˆæœ¬å…¼å®¹ â†’ è™šæ‹Ÿç¯å¢ƒç®¡ç†
8. è®¤è¯é—®é¢˜ â†’ æƒé™ç±»é…ç½®
9. UIä½ç½® â†’ CSSåŠ¨ç”»è°ƒæ•´

### 8.3 å¼€å‘ç»éªŒæ€»ç»“

**æœ€ä½³å®è·µ**ï¼š
- å‰åç«¯åˆ†ç¦»æ¶æ„æ¸…æ™°æ˜“ç»´æŠ¤
- APIæ–‡æ¡£è‡ªåŠ¨ç”Ÿæˆæé«˜æ•ˆç‡
- è™šæ‹Ÿç¯å¢ƒéš”ç¦»é¿å…å†²çª
- Gitç‰ˆæœ¬æ§åˆ¶ä¾¿äºå›æ»š
- æ—¥å¿—è®°å½•å¸®åŠ©é—®é¢˜å®šä½

**ä¼˜åŒ–ç»éªŒ**ï¼š
- æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆç´¢å¼•ã€é¢„åŠ è½½ï¼‰
- å‰ç«¯æ‡’åŠ è½½å‡å°‘åˆå§‹åŠ è½½
- APIåˆ†é¡µå‡å°‘æ•°æ®ä¼ è¾“
- ç¼“å­˜æœºåˆ¶å‡å°‘é‡å¤è®¡ç®—

**è°ƒè¯•æŠ€å·§**ï¼š
- Chrome DevToolsç½‘ç»œè°ƒè¯•
- Django Debug Toolbaræ€§èƒ½åˆ†æ
- Vue DevToolsçŠ¶æ€æŸ¥çœ‹
- GPU-Zæ˜¾å­˜ç›‘æ§
- æ—¥å¿—åˆ†çº§è¾“å‡º

---

## ğŸš€ æœªæ¥å±•æœ›

### 9.1 åŠŸèƒ½æ‰©å±•

**çŸ­æœŸè®¡åˆ’**ï¼š
- [ ] ç”¨æˆ·ç¤¾äº¤åŠŸèƒ½ï¼ˆå…³æ³¨ã€ç§ä¿¡ï¼‰
- [ ] æ¨èç®—æ³•ä¼˜åŒ–
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] ç§»åŠ¨ç«¯APP
- [ ] æ•°æ®å¯è§†åŒ–

**é•¿æœŸè§„åˆ’**ï¼š
- [ ] è§†é¢‘é¢„å‘Šç‰‡æ’­æ”¾
- [ ] å®æ—¶å¼¹å¹•ç³»ç»Ÿ
- [ ] ç›´æ’­åŠŸèƒ½
- [ ] ä»˜è´¹ä¼šå‘˜
- [ ] ç¬¬ä¸‰æ–¹ç™»å½•

### 9.2 æŠ€æœ¯ä¼˜åŒ–

**AIæ–¹é¢**ï¼š
- [ ] å¤šæ¨¡æ€æ¨¡å‹ï¼ˆå›¾åƒ+æ–‡æœ¬ï¼‰
- [ ] æµå¼å“åº”
- [ ] ä¸ªæ€§åŒ–æ¨è
- [ ] æƒ…æ„Ÿåˆ†æ
- [ ] è¯­éŸ³äº¤äº’

**æ€§èƒ½ä¼˜åŒ–**ï¼š
- [ ] Redisç¼“å­˜å…¨é¢åº”ç”¨
- [ ] CDNåŠ é€Ÿ
- [ ] æœåŠ¡å™¨é›†ç¾¤
- [ ] è´Ÿè½½å‡è¡¡
- [ ] æ•°æ®åº“ä¸»ä»å¤åˆ¶

---

## ğŸ’¡ æ ¸å¿ƒä»£ç äº®ç‚¹å±•ç¤º

### 9.1 å‰ç«¯äº®ç‚¹ï¼šä¼˜é›…çš„AIèŠå¤©äº¤äº’

**1. é»˜è®¤æ‰“å¼€çš„æ‚¬æµ®çª—è®¾è®¡**
```vue
// frontend/src/components/MovieChatBot.vue
const isOpen = ref(true);  // é»˜è®¤æ‰“å¼€ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

// å³ä¸Šè§’å›ºå®šä½ç½®ï¼Œä¸é®æŒ¡å†…å®¹
.chat-bot-container {
  position: fixed;
  top: 80px;
  right: 24px;
  z-index: 1000;
}
```

**2. æ¸å˜è‰²ç°ä»£UIè®¾è®¡**
```css
/* ç´«è‰²æ¸å˜ä¸»é¢˜ */
background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

/* æµç•…çš„æ‚¬åœåŠ¨ç”» */
.chat-button:hover {
  transform: scale(1.1);
  box-shadow: 0 12px 32px rgba(102, 126, 234, 0.6);
}
```

**3. æ™ºèƒ½çš„å¿«æ·é—®é¢˜æŒ‰é’®**
```vue
<button @click="sendQuickMessage('æ¨ä¸½è€å¸ˆæ˜¯è°ï¼Ÿ')">
  æ¨ä¸½è€å¸ˆæ˜¯è°ï¼Ÿ
</button>
<button @click="sendQuickMessage('æ¨èä¸€éƒ¨ç§‘å¹»ç”µå½±')">
  æ¨èç§‘å¹»ç”µå½±
</button>
```

### 9.2 åç«¯äº®ç‚¹ï¼šé«˜æ•ˆçš„APIè®¾è®¡

**1. è£…é¥°å™¨é“¾å¼æƒé™æ§åˆ¶**
```python
@csrf_exempt                        # è·¨åŸŸæ”¯æŒ
@api_view(['POST'])                 # é™å®šè¯·æ±‚æ–¹æ³•
@permission_classes([AllowAny])    # å…¬å¼€è®¿é—®
def movie_chat(request):
    """AIèŠå¤©æ¥å£ - ç®€æ´ä¼˜é›…"""
    pass
```

**2. å¤šæ¡ä»¶åŠ¨æ€ç­›é€‰**
```python
def get_queryset(self):
    queryset = Movie.objects.all()

    # é“¾å¼ç­›é€‰
    if year := self.request.query_params.get('year'):
        queryset = queryset.filter(year=year)

    if genre := self.request.query_params.get('genre'):
        queryset = queryset.filter(genres__contains=genre)

    return queryset
```

**3. å¼‚å¸¸å¤„ç†çš„æœ€ä½³å®è·µ**
```python
try:
    # ä¸šåŠ¡é€»è¾‘
    ollama_response = requests.post(...)
    return Response({'success': True, 'response': result})

except requests.exceptions.Timeout:
    return Response({'error': 'è¯·æ±‚è¶…æ—¶'}, status=504)

except requests.exceptions.ConnectionError:
    return Response({'error': 'AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨'}, status=503)

except Exception as e:
    return Response({'error': f'æœåŠ¡å™¨é”™è¯¯: {str(e)}'}, status=500)
```

### 9.3 AIè®­ç»ƒäº®ç‚¹ï¼šæ˜¾å­˜ä¼˜åŒ–æŠ€æœ¯

**1. æ¢¯åº¦æ£€æŸ¥ç‚¹ + æ··åˆç²¾åº¦è®­ç»ƒ**
```python
# å¯ç”¨æ¢¯åº¦æ£€æŸ¥ç‚¹èŠ‚çœæ˜¾å­˜
if hasattr(base_model, 'gradient_checkpointing_enable'):
    base_model.gradient_checkpointing_enable()

# æ··åˆç²¾åº¦è®­ç»ƒ (FP16)
torch_dtype=torch.float16 if use_gpu else torch.float32

# å¼ºåˆ¶å•GPUé¿å…è®¾å¤‡ä¸åŒ¹é…
device_map={"": 0} if use_gpu else None
```

**2. ç¯å¢ƒå˜é‡ç®¡ç†**
```python
# æ‰€æœ‰ç¼“å­˜é‡å®šå‘åˆ°Dç›˜
os.environ['HF_HOME'] = 'D:\\huggingface_cache'
os.environ['TRANSFORMERS_CACHE'] = 'D:\\huggingface_cache'
os.environ['HF_DATASETS_CACHE'] = 'D:\\huggingface_cache\\datasets'

# ä½¿ç”¨å›½å†…é•œåƒæº
os.environ['HF_ENDPOINT'] = 'https://hf-mirror.com'
```

**3. Windows UTF-8ç¼–ç å…¼å®¹**
```python
# Windows PowerShellä¸­æ–‡æ”¯æŒ
if sys.platform == 'win32':
    import io
    sys.stdout = io.TextIOWrapper(
        sys.stdout.buffer,
        encoding='utf-8',
        errors='replace'
    )
    sys.stderr = io.TextIOWrapper(
        sys.stderr.buffer,
        encoding='utf-8',
        errors='replace'
    )
```

### 9.4 æ•°æ®åº“è®¾è®¡äº®ç‚¹

**1. å”¯ä¸€çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§**
```python
class Review(models.Model):
    class Meta:
        unique_together = ['user', 'movie']  # æ¯ä¸ªç”¨æˆ·å¯¹æ¯éƒ¨ç”µå½±åªèƒ½å†™ä¸€ç¯‡å½±è¯„
```

**2. ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½**
```python
class Movie(models.Model):
    class Meta:
        indexes = [
            models.Index(fields=['douban_rating']),
            models.Index(fields=['avg_rating']),
            models.Index(fields=['-created_at']),
        ]
```

**3. ç›¸å…³åç§°è§„èŒƒåŒ–**
```python
user = models.ForeignKey(
    settings.AUTH_USER_MODEL,
    on_delete=models.CASCADE,
    related_name='reviews',  # ç”¨æˆ·.reviews åå‘æŸ¥è¯¢
    verbose_name='ç”¨æˆ·'
)
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

- Django Official Documentation
- Vue.js 3 Documentation
- Ollama Documentation
- HuggingFace Transformers
- LoRA Paper (arxiv.org/abs/2106.09685)

---

## ğŸ“ ç»“è¯­

æœ¬é¡¹ç›®ä»é›¶å¼€å§‹ï¼Œå®Œæ•´å®ç°äº†ä¸€ä¸ªç°ä»£åŒ–ç”µå½±ç¤¾åŒºå¹³å°ã€‚é€šè¿‡å®è·µï¼Œæˆ‘æ·±å…¥æŒæ¡äº†å…¨æ ˆå¼€å‘æŠ€èƒ½ã€AIå·¥ç¨‹èƒ½åŠ›å’Œé—®é¢˜è§£å†³æ€ç»´ã€‚

**æœ€é‡è¦çš„æ”¶è·**ï¼š
1. ç³»ç»Ÿåˆ†æå’Œè§£å†³é—®é¢˜çš„èƒ½åŠ›
2. AIå¤§æ¨¡å‹å®é™…åº”ç”¨æ–¹æ³•
3. å‰åç«¯åˆ†ç¦»æ¶æ„ç†è§£
4. è°ƒè¯•å’Œä¼˜åŒ–ç»éªŒç§¯ç´¯

æ¯ä¸€ä¸ªé‡åˆ°çš„æŠ€æœ¯éš¾é¢˜ï¼Œéƒ½æ˜¯å®è´µçš„å­¦ä¹ æœºä¼šã€‚ä»Cç›˜ç©ºé—´åˆ°GPUæ˜¾å­˜ï¼Œä»CORSè·¨åŸŸåˆ°æ¨¡å‹å¹»è§‰ï¼Œæ¯æ¬¡è§£å†³éƒ½åŠ æ·±äº†å¯¹æŠ€æœ¯çš„ç†è§£ã€‚

è¿™ä¸ªé¡¹ç›®ä¸ä»…æ˜¯æŠ€æœ¯å®è·µï¼Œæ›´æ˜¯å®Œæ•´çš„å·¥ç¨‹è®­ç»ƒï¼Œå±•ç¤ºäº†æŒç»­å­¦ä¹ å’Œé—®é¢˜è§£å†³çš„èƒ½åŠ›ã€‚

---

**é¡¹ç›®ä¿¡æ¯**ï¼š

- é¡¹ç›®è·¯å¾„ï¼š`d:\BYSJ\XM\bolg\blog\`
- å¼€å‘å‘¨æœŸï¼š2025å¹´11æœˆ - è‡³ä»Š
- å¼€å‘è€…ï¼šåˆ˜è¶…
- æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0
- æœ€åæ›´æ–°ï¼š2025-11-25

---

**Â© 2025 æ™ºèƒ½ç”µå½±æ¨èç¤¾åŒºç³»ç»Ÿ - æ¯•ä¸šè®¾è®¡é¡¹ç›®**